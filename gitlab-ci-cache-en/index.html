<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  
  <title>How to cache dependencies in GitLab | HMDW/me - –±–ª–æ–≥ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="keywords" content="GitLab, CI, Docker">
  
  
  <meta name="description" content="Post about using cache in CI&#x2F;CD tasks">
<meta property="og:type" content="article">
<meta property="og:title" content="How to cache dependencies in GitLab">
<meta property="og:url" content="https://hmdw.me/gitlab-ci-cache-en/">
<meta property="og:site_name" content="HMDW&#x2F;me">
<meta property="og:description" content="Post about using cache in CI&#x2F;CD tasks">
<meta property="og:locale" content="ru_RU">
<meta property="og:image" content="https://hmdw.me/images/tests_job_cache.png">
<meta property="og:image" content="https://hmdw.me/images/tests_job_cache2.png">
<meta property="og:image" content="https://hmdw.me/images/tests_job_cache3.png">
<meta property="article:published_time" content="2021-04-08T13:20:04.000Z">
<meta property="article:modified_time" content="2026-01-13T17:49:00.492Z">
<meta property="article:author" content="Rail">
<meta property="article:tag" content="english">
<meta property="article:tag" content="gitlab">
<meta property="article:tag" content="tech">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hmdw.me/images/tests_job_cache.png">
<meta name="twitter:creator" content="@rhamdeew">
  
  
  <link rel="alternate" href="/atom.xml" title="HMDW/me" type="application/atom+xml">
  

  <!-- DNS prefetch and preconnect for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,400;1,400&family=Source+Code+Pro&display=swap" rel="stylesheet">

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#ffffff">

  
<link rel="stylesheet" href="/css/style.css">

</head>

<body>
  <a href="#main" class="skip-link" aria-label="Skip to main content">Skip to content</a>
  <div id="container">
    <button class="mobile-nav-panel" aria-label="Toggle navigation menu" aria-expanded="false">
  <i class="icon-reorder icon-large" aria-hidden="true"></i>
</button>
<header id="header">
  <h1 class="blog-title">
    <a href="/">HMDW/me</a>
  </h1>
  <nav class="nav">
    <ul>
      <li><a href="/">Home</a></li><li><a href="/projects/">Projects</a></li><li><a href="/about/">About</a></li>
      <li><a id="nav-search-btn" class="nav-icon" href="#" aria-label="Search" role="button"></a></li>
      <li><a href="/atom.xml" id="nav-rss-link" class="nav-icon" aria-label="RSS Feed"></a></li>
    </ul>
  </nav>
  <div id="search-form-wrap">
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form" role="search">
      <label for="search-input" class="visually-hidden">Search</label>
      <input id="search-input" type="search" name="q" class="search-form-input" placeholder="–ü–æ–∏—Å–∫–∞—Ç—å">
      <button type="submit" class="search-form-submit" aria-label="Submit search">&#xF002;</button>
    </form>
  </div>
</header>

    <main id="main">
      <article id="post-gitlab-ci-cache-en" class="post" itemscope itemtype="http://schema.org/Article">
  

  <header class="entry-header">
    
      
  
    <h1 class="article-title entry-title" itemprop="name">
      How to cache dependencies in GitLab
    </h1>
    

    
  </header>
  <footer class="entry-meta-header">
    <span class="meta-elements date">
      <a href="/gitlab-ci-cache-en/" class="article-date">
  <time datetime="2021-04-08T13:20:04.000Z" itemprop="datePublished">–∞–ø—Ä. 8 2021</time>
</a>
    </span>
  </footer>
  
  <div class="entry-content" itemprop="articleBody">
    
    <p><img src="/images/tests_job_cache.png" alt="GitLab CI job"></p>
<p>Hi everybody!<br>Today I want to tell you about my experience of using GitLab CI dependency caching.</p>
<span id="more"></span>

<h3 id="Why-is-it-needed"><a href="#Why-is-it-needed" class="headerlink" title="Why is it needed"></a>Why is it needed</h3><p>I have a small pet project where I usually experiment with new technologies and approaches. The repository of this project is stored in GitLab. There I configured CI&#x2F;CD tasks for testing and deploying a project.</p>
<p>CI-task with testing usually completed in 2 minutes. But every time I thought about what actions are being performed in this time. An example is installing Python dependencies.</p>
<p>On one hand, this guarantees reproducible builds (let‚Äôs say hello to leftpad and mimemagick üòÑ).</p>
<p>But on the other hand, these actions are performed every time when I push changes to the repository. And that‚Äôs just a pet project.</p>
<p><strong>Let‚Äôs try to enable caching ü§ü</strong></p>
<p>Here is an official GitLab documentation about CI caching with examples - <a href="https://docs.gitlab.com/ee/ci/caching">https://docs.gitlab.com/ee/ci/caching</a></p>
<p>The project on which I tested CI-caching is written on Django and uses poetry for dependency and virtual environments management.</p>
<h3 id="What-gitlab-ci-yml-looked-like-before-the-changes"><a href="#What-gitlab-ci-yml-looked-like-before-the-changes" class="headerlink" title="What .gitlab-ci.yml looked like before the changes"></a>What .gitlab-ci.yml looked like before the changes</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line">  - tests</span><br><span class="line">  - deploy</span><br><span class="line"></span><br><span class="line">tests:</span><br><span class="line">  stage: tests</span><br><span class="line">  image: python:3.7-slim</span><br><span class="line">  script:</span><br><span class="line">    - apt-get update -qy &amp;&amp; apt-get install -y build-essential</span><br><span class="line">    - pip --no-cache-dir install poetry</span><br><span class="line">    - poetry config virtualenvs.create false &amp;&amp; poetry install --no-root</span><br><span class="line">    - sed &#x27;s/#DATABASE_URL/DATABASE_URL/g&#x27; telega/.env.example &gt; telega/.env</span><br><span class="line">    - coverage run --source=&#x27;.&#x27; manage.py test &amp;&amp; coverage report -m</span><br></pre></td></tr></table></figure>

<p>Here We install Debian packages and then install poetry through pip and install project dependencies with poetry.</p>
<h3 id="What-gitlab-ci-yml-looks-like-after-the-changes"><a href="#What-gitlab-ci-yml-looks-like-after-the-changes" class="headerlink" title="What .gitlab-ci.yml looks like after the changes"></a>What .gitlab-ci.yml looks like after the changes</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line">  - tests</span><br><span class="line">  - deploy</span><br><span class="line"></span><br><span class="line">variables:</span><br><span class="line">  PIP_CACHE_DIR: &quot;$CI_PROJECT_DIR/.cache/pip&quot;</span><br><span class="line"></span><br><span class="line">cache:</span><br><span class="line">  key:</span><br><span class="line">    files:</span><br><span class="line">      - poetry.lock</span><br><span class="line">      - .gitlab-ci.yml</span><br><span class="line">    prefix: $&#123;CI_JOB_NAME&#125;</span><br><span class="line">  paths:</span><br><span class="line">    - .venv</span><br><span class="line">    - .cache/pip</span><br><span class="line"></span><br><span class="line">tests:</span><br><span class="line">  stage: tests</span><br><span class="line">  image: python:3.7-slim</span><br><span class="line">  script:</span><br><span class="line">    - apt-get update -qy &amp;&amp; apt-get install -y build-essential</span><br><span class="line">    - pip install poetry</span><br><span class="line">    - poetry config virtualenvs.in-project true</span><br><span class="line">    - poetry install --no-root</span><br><span class="line">    - sed &#x27;s/#DATABASE_URL/DATABASE_URL/g&#x27; telega/.env.example &gt; telega/.env</span><br><span class="line">    - poetry run coverage run manage.py test &amp;&amp; poetry run coverage report -m</span><br></pre></td></tr></table></figure>

<p>I added some settings to tell pip and poetry where packages should be stored. Then I added ‚Äòcache‚Äô section and set poetry.lock and .gitlab-ci.yml files as key for cache. </p>
<p>This means that if at least one of the files is changed then packages should be installed from PyPI, but in another case will be used cached directories with already installed packages.</p>
<h3 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h3><p>CI-task running time is decreased from 2 minutes to 1 minute. Of course, the checking and unpacking cache operation was added, but it‚Äôs still faster than installing dependencies from PyPI.</p>
<p>On the screenshot with the task logs, we can see how pip use the cache.</p>
<p><img src="/images/tests_job_cache2.png" alt="GitLab CI job"></p>
<p>And here We can see that the poetry did not install anything new.</p>
<p><img src="/images/tests_job_cache3.png" alt="GitLab CI job"></p>
<p>Cache dependencies in GitLab CI&#x2F;CD are a powerful tool for faster-running tasks and the economy of resources.</p>

  </div>
  

  <footer class="entry-footer">
    <div class="entry-meta-footer">
      <div class="category">
        
      </div>
      <div class="tags">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/english/" rel="tag">english</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gitlab/" rel="tag">gitlab</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tech/" rel="tag">tech</a></li></ul>

      </div>
    </div>
  </footer>
  
  
<nav id="article-nav">
  
    <a href="/gcp-docker-logs/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          –õ–æ–≥–∏ –∏–∑ Docker –≤ Google Cloud
        
      </div>
    </a>
  
  
    <a href="/gitlab-ci-cache/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à –≤ GitLab CI
        
      </div>
    </a>
  
</nav>

  
</article>




<section id="comments">
  <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>


    </main>
    <footer id="footer">
  <h2 class="footer-blog-title">
    <a href="/">HMDW/me</a>
  </h2>
  <div class="copyright">
  <!--noindex-->
    &copy; 2026 Rail<br>
    Powered by <a href="https://hexo.io/" target="_blank" rel="noopener noreferrer">Hexo</a>
  <!--/noindex-->
  </div>
</footer>
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
  (function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
      try {
        w.yaCounter32857010 = new Ya.Metrika({
          id:32857010,
          clickmap:true,
          trackLinks:true,
          accurateTrackBounce:true
        });
      } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
      s = d.createElement("script"),
      f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = "https://mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
      d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/32857010" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

    
<script>
  var disqus_shortname = 'hmdw';
  
  var disqus_url = 'https://hmdw.me/gitlab-ci-cache-en/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//go.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script src="/js/script.js"></script>

  </div>
</body>
</html>